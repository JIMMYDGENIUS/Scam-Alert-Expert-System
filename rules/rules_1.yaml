# ==========================================================
# Scam Expert System Rule Base  (v1.1)
# ==========================================================
definitions:
  urgent_words: &urgent
    ["urgent", "immediately", "within 10 minutes", "within 5 minutes", "final warning"]
  secrecy_words: &secret
    ["don't tell", "confidential", "keep this between us"]
  otp_words: &otp
    ["otp", "one time password", "one-time password", "two-factor code",
     "verification code", "pin", "pin code", "security code", "auth code",
     "seed phrase", "recovery phrase", "private key"]

rules:
  # -------------------------------
  # ðŸ”¹ Bank Fraud / OTP / PIN Theft
  # -------------------------------
  - id: R001
    category: "Bank Fraud"
    severity: "high"
    version: 1.1
    description: Requests OTP, PIN, or seed/verification codes
    conditions:
      any:
        - text.contains_any: *otp
        - text.regex: "(?i)(send|enter|provide|share).*?(otp|pin|code|seed|phrase|private\\s*key)"
    weight: 50
    mitigations: ["warn_user", "block_if_repeated"]
    evidence: ["matched_terms"]

  - id: R002
    category: "Bank Fraud"
    severity: "medium"
    version: 1.1
    description: Account suspension or locking threats
    conditions:
      any:
        - text.contains_any: ["account suspended", "account blocked", "account locked", "deactivated"]
    weight: 30

  # -------------------------------
  # ðŸ”¹ Crypto Investment / Wallet Fraud
  # -------------------------------
  - id: R010
    category: "Crypto Scam"
    severity: "high"
    version: 1.1
    description: Crypto wallet / payment request
    conditions:
      any:
        - text.contains_any: ["wallet address", "bitcoin address", "usdt", "ethereum",
                              "crypto transfer", "bnb", "doge", "airdrop", "staking reward"]
        - text.regex: "(?i)(btc|eth|usdt|bnb|doge)\\s*(address|wallet)"
    weight: 45

  - id: R011
    category: "Crypto Scam"
    severity: "medium"
    version: 1.1
    description: Unrealistic crypto investment promises
    conditions:
      any:
        - text.contains_any: ["double your money", "200% profit", "guaranteed returns",
                              "risk-free investment", "instant millionaire"]
    weight: 35

  # -------------------------------
  # ðŸ”¹ Fake Job Offers / Employment Scam
  # -------------------------------
  - id: R020
    category: "Job Scam"
    severity: "medium"
    version: 1.1
    description: Fake job offer requiring payment
    conditions:
      all:
        - text.contains_any: ["job offer", "congratulations", "selected for a job",
                              "employment opportunity"]
        - text.contains_any: ["processing fee", "registration fee", "training fee",
                              "pay to apply"]
    weight: 40

  - id: R021
    category: "Job Scam"
    severity: "medium"
    version: 1.1
    description: Work-from-home or instant-income claims
    conditions:
      any:
        - text.contains_any: ["earn $500 daily", "work from home", "easy money",
                              "instant income", "no experience needed"]
    weight: 30

  # -------------------------------
  # ðŸ”¹ Lottery / Prize Scam
  # -------------------------------
  - id: R030
    category: "Lottery Scam"
    severity: "medium"
    version: 1.1
    description: Lottery or prize winnings
    conditions:
      any:
        - text.contains_any: ["lottery winner", "you have won", "claim your prize", "jackpot"]
    weight: 35

  - id: R031
    category: "Lottery Scam"
    severity: "high"
    version: 1.1
    description: Prize claim requiring payment or bank details
    conditions:
      all:
        - text.contains_any: ["won", "prize", "reward", "congratulations"]
        - text.contains_any: ["bank details", "delivery charge", "processing fee", "service fee"]
    weight: 42

  # -------------------------------
  # ðŸ”¹ Phishing / Fake Links
  # -------------------------------
  - id: R040
    category: "Phishing"
    severity: "high"
    version: 1.1
    description: Suspicious URLs or look-alike domains
    conditions:
      any:
        - url.display_domain_neq_final: true
        - url.lookalike_threshold: 0.8
    weight: 40
    evidence: ["display_domain", "final_domain", "lookalike_score"]

  - id: R041
    category: "Phishing"
    severity: "high"
    version: 1.1
    description: Fake login or verification pages
    conditions:
      any:
        - text.contains_any: ["verify your account", "login immediately", "secure your email"]
        - text.regex: "(?i)http[s]?://[a-z0-9.-]+(support|security|verify|account)[^\\s]*"
    weight: 45

  - id: R042
    category: "Phishing"
    severity: "medium"
    version: 1.1
    description: Use of URL shorteners often abused by scammers
    conditions:
      any:
        - text.regex: "(?i)(bit\\.ly|tinyurl|t\\.co|goo\\.gl|is\\.gd|shorte\\.st)"
    weight: 25

  - id: R043
    category: "Phishing"
    severity: "medium"
    version: 1.1
    description: Suspicious top-level domain (TLD)
    conditions:
      any:
        - text.regex: "(?i)\\.[xX][yY][zZ]|\\.[tT][oO][pP]|\\.[cC][nN]"
    weight: 25

  # -------------------------------
  # ðŸ”¹ Urgency & Secrecy Red Flags
  # -------------------------------
  - id: R050
    category: "Social Engineering"
    severity: "medium"
    version: 1.1
    description: Urgency + secrecy combo
    conditions:
      all:
        - text.contains_any: *urgent
        - text.contains_any: *secret
    weight: 35

  # -------------------------------
  # ðŸ”¹ Blacklist / Reputation
  # -------------------------------
  - id: R060
    category: "Reputation"
    severity: "critical"
    version: 1.1
    description: Sender is blacklisted or has many recent reports
    conditions:
      any:
        - reputation.reports_last_90d_gte: 3
        - reputation.global_blacklist: true
    weight: 70
    hard_stop: true

  # -------------------------------
  # ðŸ”¹ Hard-Stop Examples
  # -------------------------------
  - id: R999
    category: "Confirmed Fraud"
    severity: "critical"
    version: 1.1
    description: Known confirmed fraud source
    conditions:
      all:
        - sender.confirmed_mule: true
    weight: 100
    hard_stop: true
